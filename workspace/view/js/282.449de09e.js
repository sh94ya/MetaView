"use strict";(globalThis["webpackChunkais"]=globalThis["webpackChunkais"]||[]).push([[282],{4450:(e,t,l)=>{l.r(t),l.d(t,{default:()=>ue});var a=l(9835),o=l(6970);const n={class:"q-pa-md"},r=(0,a._)("h6",{class:"header-top"},"Управление задачами",-1),s={align:"right",style:{float:"right"}},i=(0,a.Uk)(" Редактировать "),d=(0,a.Uk)(" Удалиить "),u={key:0},c={key:1},p={key:0},m=(0,a.Uk)("Выполняется"),f=(0,a.Uk)("Завершено"),_={key:1};function w(e,t,l,w,g,k){const b=(0,a.up)("q-icon"),v=(0,a.up)("q-input"),h=(0,a.up)("q-btn"),W=(0,a.up)("q-toggle"),q=(0,a.up)("q-checkbox"),C=(0,a.up)("q-tooltip"),y=(0,a.up)("q-card-section"),Z=(0,a.up)("q-separator"),V=(0,a.up)("q-item-label"),Q=(0,a.up)("q-item-section"),D=(0,a.up)("q-item"),S=(0,a.up)("q-list"),U=(0,a.up)("q-card"),H=(0,a.up)("q-table");return(0,a.wg)(),(0,a.iD)("div",n,[r,(0,a.Wm)(H,{title:"Управление задачами",rows:w.Rows,"grid-header":"",columns:w.columns,"row-key":"id",selection:"multiple",selected:w.selected,"onUpdate:selected":t[2]||(t[2]=e=>w.selected=e),filter:w.filter,grid:"","rows-per-page-options":[10],"hide-header":"",ref:"q_table",onSelection:w.handleSelectRow},{"top-right":(0,a.w5)((()=>[(0,a.Wm)(v,{borderless:"",dense:"",debounce:"300",modelValue:w.filter,"onUpdate:modelValue":t[0]||(t[0]=e=>w.filter=e),placeholder:"Поиск"},{append:(0,a.w5)((()=>[(0,a.Wm)(b,{name:"search"})])),_:1},8,["modelValue"])])),"top-left":(0,a.w5)((()=>[(0,a.Wm)(h,{color:"green","icon-right":"add",label:"Add","no-caps":"",class:"button-top",onClick:w.Add_task},null,8,["onClick"]),(0,a.Wm)(h,{color:"red","icon-right":"delete",label:"Delete","no-caps":"",class:"button-top",ref:"delete_button",onClick:w.Delete_task},null,8,["onClick"]),(0,a.Wm)(h,{color:"primary","icon-right":"refresh",label:"Refresh","no-caps":"",class:"button-top",onClick:w.Refresh_tasks},null,8,["onClick"]),(0,a.Wm)(W,{modelValue:w.tableSelectable,"onUpdate:modelValue":t[1]||(t[1]=e=>w.tableSelectable=e),label:"Selectable"},null,8,["modelValue"])])),item:(0,a.w5)((e=>[(0,a._)("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:(0,o.j5)(e.selected?"transform: scale(0.95);":"")},[(0,a.Wm)(U,{class:(0,o.C_)([e.row.status?"q-card-confirmed":""])},{default:(0,a.w5)((()=>[(0,a.Wm)(y,null,{default:(0,a.w5)((()=>[w.tableSelectable?((0,a.wg)(),(0,a.j4)(q,{key:0,dense:"",modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t},null,8,["modelValue","onUpdate:modelValue"])):(0,a.kq)("",!0),(0,a._)("b",null,(0,o.zw)(e.row.name),1),(0,a._)("div",s,[(0,a.Wm)(h,{color:"green",class:"button-top",padding:"none",onClick:t=>w.EditItem(e.row.id),icon:"edit"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[i])),_:1})])),_:2},1032,["onClick"]),(0,a.Wm)(h,{color:"red",class:"button-top",padding:"none",onClick:t=>w.deleteItem(e.row.id),icon:"delete"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[d])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024),(0,a.Wm)(Z),(0,a.Wm)(S,{dense:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.cols.filter((e=>"desc"!==e.name)),(e=>((0,a.wg)(),(0,a.j4)(D,{clickable:"",key:e.name},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(V,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.label),1)])),_:2},1024)])),_:2},1024),(0,a.Wm)(Q,{side:""},{default:(0,a.w5)((()=>["performers"==e.name?((0,a.wg)(),(0,a.iD)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.value,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.value},[(0,a.Wm)(V,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.username)+" - "+(0,o.zw)(e.fullname),1)])),_:2},1024)])))),128))])):((0,a.wg)(),(0,a.iD)("div",c,["status"==e.name?((0,a.wg)(),(0,a.iD)("div",p,[0==e.value?((0,a.wg)(),(0,a.j4)(V,{key:0,caption:""},{default:(0,a.w5)((()=>[m])),_:1})):((0,a.wg)(),(0,a.j4)(V,{key:1,caption:""},{default:(0,a.w5)((()=>[f])),_:1}))])):((0,a.wg)(),(0,a.iD)("div",_,[(0,a.Wm)(V,{class:"truncate-textm",caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.value),1)])),_:2},1024)]))]))])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["class"])],4)])),_:1},8,["rows","columns","selected","filter","onSelection"])])}var g=l(499),k=l(1184);const b=e=>((0,a.dD)("data-v-7c2e778a"),e=e(),(0,a.Cn)(),e),v=b((()=>(0,a._)("div",{class:"text-h6"},"Edit Task",-1))),h={class:"text-subtitle2"},W={class:"row items-center justify-end"},q={class:"row items-center justify-end"},C=(0,a.Uk)("Завершено"),y=(0,a.Uk)("Выполняется");function Z(e,t,l,n,r,s){const i=(0,a.up)("q-card-section"),d=(0,a.up)("q-input"),u=(0,a.up)("q-item-label"),c=(0,a.up)("q-item-section"),p=(0,a.up)("q-item"),m=(0,a.up)("q-select"),f=(0,a.up)("q-btn"),_=(0,a.up)("q-date"),w=(0,a.up)("q-popup-proxy"),g=(0,a.up)("q-icon"),k=(0,a.up)("q-time"),b=(0,a.up)("q-label"),Z=(0,a.up)("q-toggle"),V=(0,a.up)("q-form"),Q=(0,a.up)("q-card"),D=(0,a.up)("q-card-actions"),S=(0,a.up)("q-dialog"),U=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(S,{ref:"dialogRef"},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"my-parent-card",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{bordered:"",class:(0,o.C_)([n.prop1.status?"q-card-confirmed":"","my-card"])},{default:(0,a.w5)((()=>[(0,a.Wm)(i,null,{default:(0,a.w5)((()=>[v,(0,a._)("div",h,"ID - "+(0,o.zw)(n.prop1.id),1)])),_:1}),(0,a.Wm)(V,{class:"q-gutter-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{filled:"",modelValue:n.prop1.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.prop1.name=e),label:"Задача",hint:"Описание задачи","lazy-rules":"",autogrow:""},null,8,["modelValue"]),(0,a.Wm)(d,{filled:"",modelValue:n.prop1.description,"onUpdate:modelValue":t[1]||(t[1]=e=>n.prop1.description=e),label:"Описание",hint:"Описание задачи",type:"textarea","lazy-rules":"",autogrow:""},null,8,["modelValue"]),(0,a.Wm)(m,{modelValue:n.prop1.performers,"onUpdate:modelValue":t[2]||(t[2]=e=>n.prop1.performers=e),multiple:"",options:n.options,label:"Исполнитель",onInputValue:n.setModel,"options-selected-class":"text-deep-orange"},{option:(0,a.w5)((e=>[(0,a.Wm)(p,(0,o.vs)((0,a.F4)(e.itemProps)),{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.opt.username),1)])),_:2},1024),(0,a.Wm)(u,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.opt.fullname),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","onInputValue"]),(0,a.Wm)(d,{filled:"",modelValue:n.prop1.final_date,"onUpdate:modelValue":t[5]||(t[5]=e=>n.prop1.final_date=e),label:"Контрольный срок"},{prepend:(0,a.w5)((()=>[(0,a.Wm)(g,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{modelValue:n.prop1.final_date,"onUpdate:modelValue":t[3]||(t[3]=e=>n.prop1.final_date=e),mask:"YYYY-MM-DD HH:mm","today-btn":""},{default:(0,a.w5)((()=>[(0,a._)("div",W,[(0,a.wy)((0,a.Wm)(f,{label:"Close",color:"primary",flat:""},null,512),[[U]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),append:(0,a.w5)((()=>[(0,a.Wm)(g,{name:"access_time",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{modelValue:n.prop1.final_date,"onUpdate:modelValue":t[4]||(t[4]=e=>n.prop1.final_date=e),mask:"YYYY-MM-DD HH:mm",format24h:""},{default:(0,a.w5)((()=>[(0,a._)("div",q,[(0,a.wy)((0,a.Wm)(f,{label:"Close",color:"primary",flat:""},null,512),[[U]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(Z,{modelValue:n.prop1.status,"onUpdate:modelValue":t[6]||(t[6]=e=>n.prop1.status=e)},{default:(0,a.w5)((()=>[n.prop1.status?((0,a.wg)(),(0,a.j4)(b,{key:0},{default:(0,a.w5)((()=>[C])),_:1})):((0,a.wg)(),(0,a.j4)(b,{key:1},{default:(0,a.w5)((()=>[y])),_:1}))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["class"]),(0,a.Wm)(D,{align:"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{color:"green",label:"OK",onClick:n.onOKClick},null,8,["onClick"]),(0,a.Wm)(f,{color:"primary",label:"Cancel",onClick:n.onCancelClick},null,8,["onClick"])])),_:1})])),_:1})])),_:1},512)}var V=l(4182),Q=l(9302),D=l(1049),S=l(1569),U=l(7701);const H={props:{selected_items:Array},emits:[],setup(e){const{dialogRef:t,onDialogHide:l,onDialogOK:a,onDialogCancel:o}=(0,V.Z)(),n=(0,Q.Z)(),r=(0,g.iH)(JSON.parse(JSON.stringify(e.selected_items))),s=(0,D.oR)();var i=null;const d=(0,g.iH)(s.state.users),u=(0,g.iH)(null),c=(0,g.iH)((new Date).toISOString().slice(0,10)+" 00:00");function p(){this.prop.owner=this.options.find((e=>e.value==this.prop.owner.label))}function m(e){console.log(e)}function f(e){row.owner=e.username}async function _(e,t){let l=new Promise(((l,o)=>{setTimeout((()=>{l(!1);const o={Authorization:"Bearer "+s.state.current_user.token};S.api.post("/edit_task",{workspace:e,data:t},{headers:o}).then((e=>{200==e.data.rsp_k?(i=r.value,a({prop:i}),(0,U.$)(n,"positive","Запись отредактирована","","done")):((0,U.$)(n,"negative","Ошибка",e.data.message,"report_problem"),l(!1))})).catch((()=>{(0,U.$)(n,"negative","Ошибка","","report_problem"),l(!1)}))}),1e3)})),o=await l;return o}return{dialogRef:t,task:u,date:c,create:p,prop1:r,options:d,prop:i,handler:m,setModel:f,Edit_item:_,onDialogHide:l,onOKClick(){var e=JSON.parse(JSON.stringify(r.value));e.performers=r.value.performers.map((e=>e.id)),_(s.state.current_project,JSON.stringify(e))},onCancelClick:o}}};var I=l(1639),T=l(2074),j=l(4458),R=l(3190),x=l(8326),z=l(3119),O=l(6384),A=l(490),Y=l(1233),E=l(3115),P=l(2857),$=l(2765),K=l(4351),M=l(8879),B=l(6770),J=l(3175),N=l(1821),F=l(2146),L=l(9984),G=l.n(L);const X=(0,I.Z)(H,[["render",Z],["__scopeId","data-v-7c2e778a"]]),ee=X;G()(H,"components",{QDialog:T.Z,QCard:j.Z,QCardSection:R.Z,QForm:x.Z,QInput:z.Z,QSelect:O.Z,QItem:A.Z,QItemSection:Y.Z,QItemLabel:E.Z,QIcon:P.Z,QPopupProxy:$.Z,QDate:K.Z,QBtn:M.Z,QTime:B.Z,QToggle:J.Z,QCardActions:N.Z}),G()(H,"directives",{ClosePopup:F.Z});var te=l(1746);const le=[{name:"id",align:"center",label:"ID",field:"id",sortable:!0},{name:"header",label:"Задача",required:!0,align:"left",field:e=>e.name,format:e=>`${e}`,sortable:!0},{name:"description",align:"center",label:"Описание",field:"description",sortable:!0},{name:"performers",label:"Исполнитель",field:"performers",sortable:!0},{name:"final_date",label:"Контрольный срок",field:"final_date",sortable:!0},{name:"status",label:"Статус",field:"status",sortable:!0}];var ae=[];const oe={name:"PageIndex",setup(){const e=(0,D.oR)(),t=(0,g.iH)([]),l=(0,Q.Z)(),o=((0,g.iH)(!1),(0,a.Fl)((()=>e.state.current_project)),(0,g.iH)([...ae])),n=(0,g.iH)(null),r=(0,g.iH)(e.state.users),s=(0,g.iH)(!1),i=(0,g.iH)(null),d=(0,g.iH)(!1);function u(){s.value=!0;const t={Authorization:"Bearer "+e.state.current_user.token};S.api.get("/get_users_tasks",{params:{workspace:e.state.current_project},headers:t}).then((e=>{o.value=e.data,s.value=!1})).catch((()=>{s.value=!1,(0,U.$)(l,"negative","Ошибка","Не удалось загрузить "+i.value.title,"report_problem")}))}function c(){const t={Authorization:"Bearer "+e.state.current_user.token};S.api.get("/get_users_info",{params:{workspace:e.state.current_project},headers:t}).then((t=>{e.commit("SET_USERS",t.data)})).catch((()=>{(0,U.$)(l,"negative","Ошибка","Не удалось загрузить данные по пользователям","report_problem")}))}function p(){l.dialog({component:k.Z,componentProps:{parent_component:"ManageTasks"}}).onOk((e=>{o.value.push(e.row.value[0])}))}function m(a){setTimeout((()=>{const n={Authorization:"Bearer "+e.state.current_user.token};S.api.post("/del_task",{workspace:e.state.current_project,data:a},{headers:n}).then((n=>{200==n.data.rsp_k?(o.value.splice(o.value.indexOf(a),1),t.value=t.value.filter((e=>e.id!=a.id)),e.state.current_project==a&&e.commit("SET_CURRENT_PROJECT",null),(0,U.$)(l,"positive","Запись удалена","","done")):(0,U.$)(l,"negative","Ошибка",n.data.message,"report_problem")})).catch((()=>{(0,U.$)(l,"negative","Ошибка","Не удалось удалить запись!","report_problem")}))}),1e3)}function f(){for(var e=t.value.filter((e=>e.id)),l=0;l<e.length;l++)m(e[l].id)}function _(e){var t=o.value.find((t=>t.id==e));l.dialog({component:ee,componentProps:{selected_items:t}}).onOk((e=>{if(void 0!=e){const t=o.value.findIndex((t=>t.id==e.prop.id));t>-1&&(o.value[t]=e.prop)}}))}function w(){u(),c()}function b(e){t.value=e.rows}return(0,a.YP)((()=>e.state.watch_add_task),(()=>{null!=e.state.watch_add_task&&(o.value.push(e.state.watch_add_task),e.commit("SET_WATCH_ADD_TASK",null))})),(0,a.bv)((()=>{u(),c()})),{filter:(0,g.iH)(""),selected:t,columns:le,Rows:o,options:r,loading:s,q_table:i,delete_button:n,tableSelectable:d,Add_task:p,Delete_task:f,Refresh_tasks:w,deleteItem:m,EditItem:_,loadData:u,loadData_users:c,handleSelectRow:b}}};var ne=l(1221),re=l(6858),se=l(926),ie=l(3246);const de=(0,I.Z)(oe,[["render",w]]),ue=de;G()(oe,"components",{QTable:te.Z,QInput:z.Z,QIcon:P.Z,QBtn:M.Z,QToggle:J.Z,QCard:j.Z,QCardSection:R.Z,QCheckbox:ne.Z,QTooltip:re.Z,QSeparator:se.Z,QList:ie.Z,QItem:A.Z,QItemSection:Y.Z,QItemLabel:E.Z})}}]);