"use strict";(globalThis["webpackChunkMetaView"]=globalThis["webpackChunkMetaView"]||[]).push([[803],{1803:(e,l,t)=>{t.r(l),t.d(l,{default:()=>z});t(3150),t(3218),t(8268);var a=t(1758),o=t(8790);const n={class:"q-pa-md"},s={align:"right",style:{float:"right"}},r={key:0},i={key:1},d={key:0},c={key:1};function u(e,l,t,u,b,k){const m=(0,a.g2)("q-icon"),f=(0,a.g2)("q-input"),p=(0,a.g2)("q-btn"),v=(0,a.g2)("q-toggle"),_=(0,a.g2)("q-checkbox"),g=(0,a.g2)("q-avatar"),h=(0,a.g2)("q-chip"),C=(0,a.g2)("q-item-section"),w=(0,a.g2)("q-item-label"),F=(0,a.g2)("q-item"),A=(0,a.g2)("q-list"),y=(0,a.g2)("q-btn-dropdown"),I=(0,a.g2)("q-card-section"),W=(0,a.g2)("q-separator"),q=(0,a.g2)("q-card"),S=(0,a.g2)("q-table"),Q=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)("div",n,[l[11]||(l[11]=(0,a.Lk)("h6",{class:"header-top"},"Users Tasks",-1)),(0,a.bF)(S,{title:"Управление задачами",rows:u.Rows,"grid-header":"",columns:u.columns,"row-key":"id",selection:"multiple",selected:u.selected,"onUpdate:selected":l[2]||(l[2]=e=>u.selected=e),filter:u.filter,grid:"","rows-per-page-options":[10],"hide-header":"",onSelection:u.handleSelectRow},{"top-right":(0,a.k6)(()=>[(0,a.bF)(f,{borderless:"",dense:"",debounce:"300",modelValue:u.filter,"onUpdate:modelValue":l[0]||(l[0]=e=>u.filter=e),placeholder:"Поиск"},{append:(0,a.k6)(()=>[(0,a.bF)(m,{name:"search"})]),_:1},8,["modelValue"])]),"top-left":(0,a.k6)(()=>[(0,a.bF)(p,{size:"sm",color:"green","icon-right":"add",label:"Add","no-caps":"",class:"button-top",onClick:u.AddItem},null,8,["onClick"]),u.selected.length>0?((0,a.uX)(),(0,a.Wv)(p,{key:0,size:"sm",color:"red","icon-right":"delete",label:"Delete","no-caps":"",class:"button-top",ref:"delete_button",onClick:u.DeleteItems},null,8,["onClick"])):(0,a.Q3)("",!0),(0,a.bF)(p,{size:"sm",color:"blue","icon-right":"refresh",label:"Refresh","no-caps":"",class:"button-top",onClick:u.Refresh},null,8,["onClick"]),(0,a.bF)(v,{modelValue:u.tableSelectable,"onUpdate:modelValue":l[1]||(l[1]=e=>u.tableSelectable=e),label:"Selectable"},null,8,["modelValue"])]),item:(0,a.k6)(t=>[(0,a.Lk)("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:(0,o.Tr)(t.selected?"transform: scale(0.95);":"")},[(0,a.bF)(q,{class:(0,o.C4)([t.row.status?"q-card-overlay":""])},{default:(0,a.k6)(()=>[(0,a.bF)(I,null,{default:(0,a.k6)(()=>[u.tableSelectable?((0,a.uX)(),(0,a.Wv)(_,{key:0,dense:"",modelValue:t.selected,"onUpdate:modelValue":e=>t.selected=e},null,8,["modelValue","onUpdate:modelValue"])):(0,a.Q3)("",!0),(0,a.bF)(h,{square:"",disable:u.DisableCard(t.row)},{default:(0,a.k6)(()=>[(0,a.bF)(g,{size:"lg"},{default:(0,a.k6)(()=>[1==t.row.status?((0,a.uX)(),(0,a.Wv)(m,{key:0,name:"event_available"})):((0,a.uX)(),(0,a.Wv)(m,{key:1,name:"edit_calendar"}))]),_:2},1024),(0,a.Lk)("b",null,(0,o.v_)(t.row.name),1)]),_:2},1032,["disable"]),(0,a.Lk)("div",s,[(0,a.bF)(y,{class:"glossy",color:"teal",label:"Action",size:"sm",onClick:e.onMainClick},{default:(0,a.k6)(()=>[(0,a.bF)(A,null,{default:(0,a.k6)(()=>[(0,a.bo)(((0,a.uX)(),(0,a.Wv)(F,{clickable:"",onClick:l=>e.InfoProject(t.row.id,t.row.name)},{default:(0,a.k6)(()=>[(0,a.bF)(C,{avatar:""},{default:(0,a.k6)(()=>[(0,a.bF)(g,{icon:"info",color:"blue","text-color":"white"})]),_:1}),(0,a.bF)(C,null,{default:(0,a.k6)(()=>[(0,a.bF)(w,null,{default:(0,a.k6)(()=>[...l[3]||(l[3]=[(0,a.eW)("Info",-1)])]),_:1}),(0,a.bF)(w,{caption:""},{default:(0,a.k6)(()=>[...l[4]||(l[4]=[(0,a.eW)("Получить информацию о задаче",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Q]]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(F,{clickable:"",onClick:e=>u.EditItem(t.row.id)},{default:(0,a.k6)(()=>[(0,a.bF)(C,{avatar:""},{default:(0,a.k6)(()=>[(0,a.bF)(g,{icon:"edit",color:"green","text-color":"white"})]),_:1}),(0,a.bF)(C,null,{default:(0,a.k6)(()=>[(0,a.bF)(w,null,{default:(0,a.k6)(()=>[...l[5]||(l[5]=[(0,a.eW)("Edit",-1)])]),_:1}),(0,a.bF)(w,{caption:""},{default:(0,a.k6)(()=>[...l[6]||(l[6]=[(0,a.eW)("Редактировать задачу",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Q]]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(F,{clickable:"",onClick:e=>u.DeleteItem(t.row.id)},{default:(0,a.k6)(()=>[(0,a.bF)(C,{avatar:""},{default:(0,a.k6)(()=>[(0,a.bF)(g,{icon:"delete",color:"red","text-color":"white"})]),_:1}),(0,a.bF)(C,null,{default:(0,a.k6)(()=>[(0,a.bF)(w,null,{default:(0,a.k6)(()=>[...l[7]||(l[7]=[(0,a.eW)("Delete",-1)])]),_:1}),(0,a.bF)(w,{caption:""},{default:(0,a.k6)(()=>[...l[8]||(l[8]=[(0,a.eW)("Удалить задачу",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Q]])]),_:2},1024)]),_:2},1032,["onClick"])])]),_:2},1024),(0,a.bF)(W),(0,a.bF)(A,{dense:""},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.cols.filter(e=>"desc"!==e.name),e=>((0,a.uX)(),(0,a.Wv)(F,{clickable:"",key:e.name,disable:u.DisableCard(t.row)},{default:(0,a.k6)(()=>[(0,a.bF)(C,null,{default:(0,a.k6)(()=>[(0,a.bF)(w,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(e.label),1)]),_:2},1024)]),_:2},1024),(0,a.bF)(C,{side:""},{default:(0,a.k6)(()=>["performers"==e.name?((0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(h,null,{default:(0,a.k6)(()=>[(0,a.bF)(g,{icon:"groups"}),(0,a.eW)(" "+(0,o.v_)(e.value.map(e=>e.username).join(", ")),1)]),_:2},1024)])):((0,a.uX)(),(0,a.CE)("div",i,["status"==e.name?((0,a.uX)(),(0,a.CE)("div",d,[0==e.value?((0,a.uX)(),(0,a.Wv)(w,{key:0,caption:""},{default:(0,a.k6)(()=>[...l[9]||(l[9]=[(0,a.eW)("Выполняется",-1)])]),_:1})):((0,a.uX)(),(0,a.Wv)(w,{key:1,caption:""},{default:(0,a.k6)(()=>[...l[10]||(l[10]=[(0,a.eW)("Завершено",-1)])]),_:1}))])):((0,a.uX)(),(0,a.CE)("div",c,[(0,a.bF)(w,{class:"truncate-text",caption:""},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(e.value),1)]),_:2},1024)]))]))]),_:2},1024)]),_:2},1032,["disable"]))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["rows","columns","selected","filter","onSelection"])])}t(6003);var b=t(8734),k=t(7124),m=t(6653),f=t(4907),p=t(6980),v=t(9827),_=t(1964),g=t(5745);const h=[{name:"header",label:"Задача",required:!0,align:"left",field:e=>e.name,format:e=>`${e}`,sortable:!0},{name:"description",align:"center",label:"Описание",field:"description",sortable:!0},{name:"performers",label:"Исполнитель",field:"performers",sortable:!0},{name:"final_date",label:"Контрольный срок",field:"final_date",sortable:!0},{name:"status",label:"Статус",field:"status",sortable:!0}];var C=[];const w={name:"UserTasks",setup(){const e=(0,p.Pj)(),l=(0,b.KR)([]),t=(0,f.A)(),o=(0,b.KR)([...C]),n=(0,b.KR)(null),s=(0,b.KR)(e.state.users),r=(0,b.KR)(!1),i=(0,b.KR)(!1);async function d(){r.value=!0;var l=(0,_.y)("table","UserTasks","getItem"),a={workspace:e.state.current_project},n=await(0,v.b)(l,a,e.state.current_user.token);void 0!=n&&n||Array.isArray(1==n)?(o.value=n,r.value=!1):(r.value=!1,n.hasOwnProperty("message")&&(0,g.e)(t,"negative","Error",n.message,"report_problem"))}async function c(){var l=(0,_.y)("table","Users","getItem"),a={workspace:e.state.current_project},o=await(0,v.b)(l,a,e.state.current_user.token);void 0!=o&&0!=o?e.commit("SET_USERS",o):(0,g.e)(t,"negative","Error",o.message,"report_problem")}function u(){t.dialog({component:k.A,componentProps:{CardAction:"AddItem",CardName:"Add Task",CardData:{name:"",description:"",performers:[],final_date:null,status:!1}}}).onOk(e=>{o.value.push(e)})}async function m(a){var n=(0,_.y)("table","UserTasks","delItem"),s={workspace:e.state.current_project,data:a},r=await(0,v.L)(n,s,null,e.state.current_user.token);void 0!=r&&0!=r?(200==r.status&&(o.value=o.value.filter(e=>e.id!==a),l.value=l.value.filter(e=>e.id!=a.id)),(0,g.e)(t,"positive","Запись удалена","","done")):(0,g.e)(t,"negative","Error",r.message,"report_problem")}function w(){for(var e=l.value.filter(e=>e.id),t=0;t<e.length;t++)m(e[t].id)}function F(e){var l=o.value.find(l=>l.id==e);t.dialog({component:k.A,componentProps:{CardAction:"EditItem",CardName:"Edit Task",CardData:JSON.parse(JSON.stringify(l))}}).onOk(e=>{if(void 0!=e){const l=o.value.findIndex(l=>l.id==e.id);l>-1&&(o.value[l]=e)}})}function A(){d(),c()}function y(e){l.value=e.rows}function I(e){return e.status}return(0,a.wB)(()=>e.state.watch_add_task,()=>{null!=e.state.watch_add_task&&(o.value.push(e.state.watch_add_task),e.commit("SET_WATCH_ADD_TASK",null))}),(0,a.sV)(()=>{d(),c()}),{filter:(0,b.KR)(""),selected:l,columns:h,Rows:o,options:s,loading:r,delete_button:n,tableSelectable:i,AddItem:u,DeleteItems:w,Refresh:A,DeleteItem:m,EditItem:F,loadData:d,loadDataUsers:c,handleSelectRow:y,DisableCard:I}}};var F=t(2807),A=t(9270),y=t(492),I=t(6384),W=t(6908),q=t(3316),S=t(4189),Q=t(460),E=t(6760),D=t(3952),X=t(1207),R=t(3999),T=t(124),V=t(5173),U=t(3796),x=t(386),K=t(8672),L=t(8582),j=t.n(L);const P=(0,F.A)(w,[["render",u]]),z=P;j()(w,"components",{QTable:m.A,QInput:A.A,QIcon:y.A,QBtn:I.A,QToggle:W.A,QCard:q.A,QCardSection:S.A,QCheckbox:Q.A,QChip:E.A,QAvatar:D.A,QBtnDropdown:X.A,QList:R.A,QItem:T.A,QItemSection:V.A,QItemLabel:U.A,QSeparator:x.A}),j()(w,"directives",{ClosePopup:K.A})}}]);