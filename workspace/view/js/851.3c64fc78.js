"use strict";(globalThis["webpackChunkais"]=globalThis["webpackChunkais"]||[]).push([[851],{1455:(e,t,l)=>{l.r(t),l.d(t,{default:()=>ee});var o=l(9835),a=l(6970);const n={class:"q-pa-md"},r=(0,o._)("h6",{class:"header-top"},"Управление проектами",-1),i={align:"right",style:{float:"right"}},c=(0,o.Uk)(" Информация по проекту "),s=(0,o.Uk)(" Редактирование проекта "),d=(0,o.Uk)(" Удалить проект "),u=(0,o.Uk)(" Сделать проект текущим ");function p(e,t,l,p,m,_){const f=(0,o.up)("q-icon"),g=(0,o.up)("q-input"),w=(0,o.up)("q-btn"),b=(0,o.up)("q-toggle"),h=(0,o.up)("q-checkbox"),v=(0,o.up)("q-tooltip"),k=(0,o.up)("q-card-section"),C=(0,o.up)("q-separator"),j=(0,o.up)("q-item-label"),R=(0,o.up)("q-item-section"),S=(0,o.up)("q-item"),W=(0,o.up)("q-list"),T=(0,o.up)("q-card"),q=(0,o.up)("q-table");return(0,o.wg)(),(0,o.iD)("div",n,[r,(0,o.Wm)(q,{title:"Управление проектами",rows:e.Rows,"grid-header":"",columns:e.columns,"row-key":"id",selection:"multiple",selected:e.selected,"onUpdate:selected":t[2]||(t[2]=t=>e.selected=t),filter:e.filter,grid:"",loading:e.loading,"rows-per-page-options":[10],"hide-header":"",ref:"table-main",onSelection:e.handleSelectRow,onAddNewProject:e.ReciveDataFromChild},{"top-right":(0,o.w5)((()=>[(0,o.Wm)(g,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filter=t),placeholder:"Поиск"},{append:(0,o.w5)((()=>[(0,o.Wm)(f,{name:"search"})])),_:1},8,["modelValue"])])),"top-left":(0,o.w5)((()=>[(0,o.Wm)(w,{color:"green","icon-right":"add",label:"Add","no-caps":"",class:"button-top",onClick:e.Add_project},null,8,["onClick"]),(0,o.Wm)(w,{color:"red","icon-right":"delete",label:"Delete","no-caps":"",ref:"delete_button",class:"button-top",onClick:e.Delete_project},null,8,["onClick"]),(0,o.Wm)(w,{color:"primary","icon-right":"refresh",label:"Refresh","no-caps":"",onClick:e.Refresh_project},null,8,["onClick"]),(0,o.Wm)(b,{modelValue:e.tableSelectable,"onUpdate:modelValue":t[1]||(t[1]=t=>e.tableSelectable=t),label:"Selectable"},null,8,["modelValue"])])),item:(0,o.w5)((t=>[(0,o._)("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:(0,a.j5)(t.selected?"transform: scale(0.95);":"")},[(0,o.Wm)(T,{class:(0,a.C_)([t.row.id==e.current_project?"q-card-confirmed":""])},{default:(0,o.w5)((()=>[(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[e.tableSelectable?((0,o.wg)(),(0,o.j4)(h,{key:0,dense:"",modelValue:t.selected,"onUpdate:modelValue":e=>t.selected=e},null,8,["modelValue","onUpdate:modelValue"])):(0,o.kq)("",!0),(0,o._)("b",null,(0,a.zw)(t.row.name),1),(0,o._)("div",i,[(0,o.Wm)(w,{color:"blue",class:"button-top",padding:"none",onClick:l=>e.InfoProject(t.row.id,t.row.name),icon:"info"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[c])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(w,{color:"green",class:"button-top",padding:"none",onClick:l=>e.EditItem(t.row.id),icon:"edit"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[s])),_:1})])),_:2},1032,["onClick"]),(0,o.Wm)(w,{color:"red",padding:"none",onClick:l=>e.DeleteItem(t.row.id),icon:"delete"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[d])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024),(0,o.Wm)(C),(0,o.Wm)(W,{dense:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols.filter((e=>"desc"!==e.name)),(l=>((0,o.wg)(),(0,o.j4)(S,{clickable:"",key:l.name},{default:(0,o.w5)((()=>[(0,o.Wm)(R,null,{default:(0,o.w5)((()=>[(0,o.Wm)(j,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(l.label),1)])),_:2},1024)])),_:2},1024),"status"!=l.name?((0,o.wg)(),(0,o.j4)(R,{key:0,side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(j,{class:"truncate-textm"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(l.value),1)])),_:2},1024)])),_:2},1024)):((0,o.wg)(),(0,o.j4)(R,{key:1,side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{icon:"check",ripple:{center:!0},round:"",size:"10px",dense:"",color:"teal",onClick:l=>e.ChangeCurrentProject(t.row.id)},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[u])),_:1})])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["class"])],4)])),_:1},8,["rows","columns","selected","filter","loading","onSelection","onAddNewProject"])])}var m=l(499),_=l(1746),f=l(9302);const g=e=>((0,o.dD)("data-v-2320e590"),e=e(),(0,o.Cn)(),e),w=g((()=>(0,o._)("div",{class:"text-h6"},"Задача",-1))),b={class:"text-subtitle2"},h=(0,o.Uk)("Текущий"),v=(0,o.Uk)("Не текущий");function k(e,t,l,n,r,i){const c=(0,o.up)("q-card-section"),s=(0,o.up)("q-input"),d=(0,o.up)("q-label"),u=(0,o.up)("q-toggle"),p=(0,o.up)("q-form"),m=(0,o.up)("q-card"),_=(0,o.up)("q-btn"),f=(0,o.up)("q-card-actions"),g=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(g,{ref:"dialogRef"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{class:"my-parent-card",style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{bordered:"",class:(0,a.C_)([n.status?"q-card-confirmed":"","my-card"])},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[w,(0,o._)("div",b,"ID - "+(0,a.zw)(n.prop1.id),1)])),_:1}),(0,o.Wm)(p,{onSubmit:e.onSubmit,onReset:e.onReset,class:"q-gutter-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{filled:"",modelValue:n.prop1.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.prop1.name=e),hint:"Имя проекта",label:"Название","lazy-rules":"",ref:"nameRef",rules:n.nameRules,autogrow:""},null,8,["modelValue","rules"]),(0,o.Wm)(s,{filled:"",modelValue:n.prop1.description,"onUpdate:modelValue":t[1]||(t[1]=e=>n.prop1.description=e),label:"Описание",hint:"Описание проекта","lazy-rules":"",autogrow:""},null,8,["modelValue"]),(0,o.Wm)(u,{modelValue:n.status,"onUpdate:modelValue":t[2]||(t[2]=e=>n.status=e)},{default:(0,o.w5)((()=>[n.status?((0,o.wg)(),(0,o.j4)(d,{key:0},{default:(0,o.w5)((()=>[h])),_:1})):((0,o.wg)(),(0,o.j4)(d,{key:1},{default:(0,o.w5)((()=>[v])),_:1}))])),_:1},8,["modelValue"])])),_:1},8,["onSubmit","onReset"])])),_:1},8,["class"]),(0,o.Wm)(f,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{color:"green",label:"OK",onClick:n.onOKClick},null,8,["onClick"]),(0,o.Wm)(_,{color:"primary",label:"Cancel",onClick:n.onCancelClick},null,8,["onClick"])])),_:1})])),_:1})])),_:1},512)}var C=l(4182),j=l(1049),R=l(1569),S=l(7701);const W={props:{selected_items:Array},emits:[],setup(e){const{dialogRef:t,onDialogHide:l,onDialogOK:o,onDialogCancel:a}=(0,C.Z)(),n=(0,f.Z)(),r=(0,m.iH)(JSON.parse(JSON.stringify(e.selected_items))),i=(0,j.oR)();var c=!1;const s=(0,m.iH)(null);c=i.state.current_project==r.value.id?(0,m.iH)(!0):(0,m.iH)(!1);const d=(0,m.iH)(i.state.users),u=(0,m.iH)(null);var p=null;const _=(0,m.iH)((new Date).toISOString().slice(0,10)+" 00:00");function g(){this.prop.owner=this.options.find((e=>e.value==this.prop.owner.label))}function w(e){console.log(e)}async function b(e){let t=new Promise(((t,l)=>{setTimeout((()=>{t(!1);const l={Authorization:"Bearer "+i.state.current_user.token};R.api.post("/api/edit_workspace",{data:e},{headers:l}).then((e=>{200==e.data.rsp_k?(p=r.value,1==c.value&&(i.commit("SET_CURRENT_PROJECT",r.value.id),i.commit("SET_CURRENT_PROJECT_LABEL",r.value.name),localStorage.setItem("current_project",JSON.stringify({project:r.value.id,label:r.value.name}))),o({prop:p}),(0,S.$)(n,"positive","Запись отредактирована","","done")):((0,S.$)(n,"negative","Ошибка",e.data.message,"report_problem"),t(!1))})).catch((()=>{(0,S.$)(n,"negative","Ошибка","","report_problem"),t(!1)}))}),1e3)})),l=await t;return l}return{dialogRef:t,task:u,date:_,options:d,prop:p,status:c,prop1:r,nameRef:s,nameRules:[e=>null!=e&&""!=e||"Заполните поле"],create:g,handler:w,edit_project:b,onDialogHide:l,onOKClick(){s.value.validate(),s.value.hasError||b(JSON.stringify(r.value))},onCancelClick:a}}};var T=l(1639),q=l(2074),Z=l(4458),y=l(3190),E=l(8326),D=l(3119),I=l(3175),O=l(1821),Q=l(8879),U=l(9984),P=l.n(U);const V=(0,T.Z)(W,[["render",k],["__scopeId","data-v-2320e590"]]),A=V;P()(W,"components",{QDialog:q.Z,QCard:Z.Z,QCardSection:y.Z,QForm:E.Z,QInput:D.Z,QToggle:I.Z,QCardActions:O.Z,QBtn:Q.Z});var H=l(5593),N=l(4276);const J=[{name:"id",align:"center",sortOrder:"da",label:"ID",field:"id",sortable:!0},{name:"name",label:"Имя проекта",field:"name",sortable:!0},{name:"description",label:"Описание",field:"description",sortable:!0},{name:"created_at",label:"Дата создания",field:"created_at",sortable:!0},{name:"status",label:"Текущий проект",field:"status"}];var x=[];const z=(0,o.aZ)({name:"PageIndex1",setup(){const e=(0,j.oR)(),t=(0,o.Fl)((()=>e.state.current_project)),l=(0,o.Fl)((()=>e.state.watch_add_project)),a=(0,m.iH)(""),n=(0,m.iH)([]),r=(0,f.Z)();var i=(0,m.iH)([...x]);const c=(0,m.iH)(!1),s=(0,m.iH)(!1);function d(){c.value=!0;const t={Authorization:"Bearer "+e.state.current_user.token};R.api.get("/api/get_workspaces",{headers:t}).then((t=>{i.value=t.data,u(e.state.current_project),c.value=!1})).catch((()=>{c.value=!1,(0,S.$)(r,"negative","Ошибка","Не удалось загрузить данные по Workspaces","report_problem")}))}function u(e){if(null!=e)for(var t=i.value.findIndex((t=>t.id==e)),l=0;l<i.value.length;l++)t==l?i.value[t].status=!0:i.value[l].status=!1}function p(){r.dialog({component:H.Z,componentProps:{parent_component:"ManageProjects"}}).onOk((e=>{i.value.push(e.row.value[0])}))}function _(){d()}function g(t){setTimeout((()=>{const l={Authorization:"Bearer "+e.state.current_user.token};R.api.post("/api/del_workspace",{data:t},{headers:l}).then((l=>{200==l.data.rsp_k?(i.value=i.value.filter((e=>e.id!==t)),e.state.current_project==t&&(e.commit("SET_CURRENT_PROJECT",null),e.commit("SET_CURRENT_PROJECT_LABEL",null),localStorage.setItem("current_project",JSON.stringify({project:null,label:null}))),(0,S.$)(r,"positive","Запись удалена","","done")):(0,S.$)(r,"negative","Ошибка",l.data.message,"report_problem")})).catch((()=>{(0,S.$)(r,"negative","Ошибка","Не удалось удалить запись!","report_problem")}))}),1e3)}function w(){for(var e=n.value.filter((e=>e.id)),t=0;t<e.length;t++)g(e[t].id)}function b(e){var t=i.value.find((t=>t.id==e));r.dialog({component:A,componentProps:{selected_items:t}}).onOk((e=>{if(void 0!=e){const t=i.value.findIndex((t=>t.id==e.prop.id));t>-1&&(i.value[t]=e.prop)}}))}function h(t,l){setTimeout((()=>{const o={Authorization:"Bearer "+e.state.current_user.token};R.api.get("/api/get_count_info",{params:{workspace:t,node:N.DS.encode(JSON.stringify({id:0,type:"root",label:""}))},headers:o}).then((e=>{let o="Узлы(hosts) - "+e.data.hosts+"\n";o+="Сервисы(services) - "+e.data.services+"\n",o+="Заметки(notes) - "+e.data.notes+"\n",o+="Учетные данные(creds)  - "+e.data.creds+"\n",o+="Полученные данные(loots) - "+e.data.loots+"\n",console.log(o),r.notify({icon:"info",progress:!0,multiLine:!0,message:"Информация по проекту "+l+" (ID - "+t+")",caption:o,position:"bottom",color:"primary"})})).catch((()=>{(0,S.$)(r,"negative","Ошибка","","report_problem")}))}),1e3)}function v(t){let l=i.value.filter((e=>e.id==t))[0].name;localStorage.setItem("current_project",JSON.stringify({project:t,label:l})),e.commit("SET_CURRENT_PROJECT",t),e.commit("SET_CURRENT_PROJECT_LABEL",l)}function k(e){n.value=e.rows}function C(e){console.log(e)}return(0,o.YP)((()=>e.state.watch_add_project),(()=>{null!=e.state.watch_add_project&&(i.value.push(e.state.watch_add_project),e.commit("SET_WATCH_ADD_PROJECT",null))})),(0,o.YP)((()=>e.state.current_project),(()=>{u(e.state.current_project)})),(0,o.YP)((()=>i.value),(()=>{console.log(i.value.id)})),(0,o.bv)((()=>{d()})),{Rows:i,tableSelectable:s,current_project:t,watch_add_project:l,columns:J,selected:n,filter:a,loading:c,loadData:d,DeleteItem:g,Add_project:p,EditItem:b,ControlToggle:u,handleSelectRow:k,Delete_project:w,InfoProject:h,ReciveDataFromChild:C,Refresh_project:_,ChangeCurrentProject:v}}});var B=l(2857),L=l(1221),$=l(6858),F=l(926),K=l(3246),Y=l(490),M=l(1233),G=l(3115);const X=(0,T.Z)(z,[["render",p]]),ee=X;P()(z,"components",{QTable:_.Z,QInput:D.Z,QIcon:B.Z,QBtn:Q.Z,QToggle:I.Z,QCard:Z.Z,QCardSection:y.Z,QCheckbox:L.Z,QTooltip:$.Z,QSeparator:F.Z,QList:K.Z,QItem:Y.Z,QItemSection:M.Z,QItemLabel:G.Z})}}]);